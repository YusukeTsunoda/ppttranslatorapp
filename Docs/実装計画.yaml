mvp_required_implementation:
  title: MVPに必要な実装項目（実装順序と詳細）
  description: 優先度順に実装すべき項目と、各項目の詳細な実装ステップ
  items:
    - description: "- [x] 1. 翻訳テキストの位置ずれ修正" #完了
      priority: highest
      phases:
        - phase_name: "分析フェーズ"
          tasks:
            - description: "- [x] 原因箇所の特定と調査" #完了
            - description: "- [x] 異なる言語間でのテキスト長変化の測定と影響評価" #完了
            - description: "- [x] フォントの違いによる影響調査" #完了
        - phase_name: "実装フェーズ"
          tasks:
            - description: "- [x] テキストボックスのサイズ自動調整ロジックの開発" #完了
            - description: "- [x] フォントマッピングテーブルの拡充" #完了
            - description: "- [x] autofit設定の最適化" #完了
            - description: "- [x] 言語別のテキスト位置調整パラメータ設定" #完了
        - phase_name: "テストフェーズ"
          tasks:
            - description: "- [x] 異なる言語ペアでのテスト（日英、英日、日中など）" #完了
            - description: "- [x] 複雑なレイアウトを含むPPTXでのテスト" #完了
            - description: "- [x] 異なるフォントを使用したテスト" #完了
      subtasks:
        - description: "- [x] PPTX生成時のテキストボックス位置・サイズ・フォント・autofit等の再計算・調整" #完了
        - description: "- [x] PPTXジェネレーターの修正" #完了
      implementation_details:
        file_paths:
          - "/app/api/pptx/generate/route.ts"
          - "/lib/pptx/generator.ts"
          - "/lib/pptx/text-position-calculator.ts"
        technical_approach:
          - "テキストボックスのオートフィット設定を言語ペアごとに最適化"
          - "フォントサイズ自動調整アルゴリズムの改良（最小/最大フォントサイズ制約付き）"
          - "テキスト長に応じたボックスサイズの動的拡張（最大拡張率の設定）"
          - "言語ごとの文字間隔・行間調整パラメータの導入"
        potential_issues:
          - "異なる言語間でのフォントメトリクスの不一致"
          - "RTL言語（アラビア語、ヘブライ語など）の特殊な配置要件"
          - "絵文字や特殊文字を含むテキストの処理"
          - "複雑なレイアウト（表、図形内テキスト）での位置調整"
        testing_strategy:
          - "言語ペアごとのテストケース作成（日英、英日、日中、日アラビア語など）"
          - "フォントバリエーションテスト（明朝体、ゴシック体、特殊フォントなど）"
          - "テキスト長の極端なケース（非常に短い/長いテキスト）のテスト"
          - "視覚的回帰テスト（生成されたPPTXの見た目を自動比較）"
        success_metrics:
          - "テキスト位置ずれの平均誤差 < 5%"
          - "テキストの切れ・はみ出し発生率 < 1%"
          - "フォントサイズの適切さ（読みやすさ）評価スコア > 4.0/5.0"

    - id: text_extraction_improvement
      description: "テキスト抽出の精度と多言語対応を底上げする"
      priority: highest
      depends_on: []
      phases:
        - phase_name: "現状分析"
          tasks:
            - "複雑レイアウトでの抽出精度を測定（基準データセット作成）"
            - "多言語テキストと特殊文字の抽出結果を評価"
            - "テキスト順序・階層構造の保持率を計測"
        - phase_name: "アルゴリズム改善"
          tasks:
            - "抽出ロジック改良（段落・表・図形別にプラグイン化）"
            - "特殊文字・絵文字・RTL 言語サポートの追加"
            - "順序保持アルゴリズムの改善（Z インデックス & 座標ソート）"
        - phase_name: "テストフェーズ"
          tasks:
            - "ベンチマークデータセットで回帰テスト"
            - "日本語↔英語／中国語／アラビア語で多言語差分テスト"
      acceptance_criteria:
        - "全言語で抽出文字列一致率 98% 以上"
        - "順序誤差 0.5% 未満"
      implementation_details:
        file_paths:
          - "/lib/pptx/parser.ts"
          - "/python/pptx_parser.py"
          - "/app/api/pptx/parse/route.ts"
        technical_approach:
          - "Python-pptx ライブラリの拡張による深層テキスト抽出"
          - "テキスト階層構造の保持（スライド > 図形 > 段落 > テキスト実行）"
          - "Z-order と空間的位置に基づく読み取り順序アルゴリズムの実装"
          - "言語固有の文字処理（CJK、RTL言語など）の強化"
        potential_issues:
          - "複雑なレイアウト（表、SmartArt）からのテキスト抽出精度"
          - "非標準フォントや特殊文字の処理"
          - "テキスト読み取り順序の言語による違い"
          - "パフォーマンス低下（処理時間の増加）"
        testing_strategy:
          - "多様なPPTXサンプルによるベンチマークテスト"
          - "言語別テストケース（日本語、英語、中国語、アラビア語など）"
          - "特殊ケーステスト（複雑な表、SmartArt、グラフィック要素内テキスト）"
          - "パフォーマンステスト（大規模PPTXでの処理時間測定）"
        success_metrics:
          - "テキスト抽出精度 > 98%（文字列一致率）"
          - "読み取り順序正確性 > 99.5%"
          - "処理時間増加 < 20%（現行比）"

    - id: translation_quality_improvement
      description: "翻訳テキストの品質向上と結果の正規化"
      priority: high
      depends_on: []
      phases:
        - phase_name: "現状分析"
          tasks:
            - "翻訳APIのレスポンス形式と余分なテキストのパターン分析"
            - "異なる言語ペアでの翻訳品質評価"
            - "エラーケースとフォールバックメカニズムの調査"
        - phase_name: "改善実装"
          tasks:
            - "翻訳結果の正規化処理の実装（余分なテキストの除去）"
            - "翻訳データの構造化と原文-翻訳文の対応関係の明確化"
            - "エラーハンドリングの強化と部分的な結果の処理"
            - "フロントエンド表示の改善（柔軟なデータ形式対応）"
        - phase_name: "テストフェーズ"
          tasks:
            - "様々な言語ペアでの翻訳品質テスト"
            - "エラーケースのシミュレーションと回復性テスト"
            - "ユーザーインターフェースでの表示確認"
      subtasks:
        - description: "- [x] 翻訳APIレスポンスからの余分なテキスト除去機能の実装" #完了
        - description: "- [x] 翻訳データの構造化とスライド単位の管理改善" #完了
        - description: "- [x] エラーハンドリングの強化とユーザーフィードバックの改善" #完了
        - description: "- [x] 翻訳モジュールの分割と責任の明確化" #完了
        - description: "- [x] 翻訳品質チェック機能の実装" #完了
        - description: "- [x] 翻訳APIルートの修正と統合" #完了
        - description: "- [x] テスト実装と品質検証" #完了
      implementation_details:
        file_paths:
          - "/app/api/translate/route.ts" #完了
          - "/lib/translation/normalizer.ts" #完了
          - "/lib/translation/types.ts" #完了
          - "/lib/translation/engine.ts" #完了
          - "/lib/translation/history.ts" #完了
          - "/lib/translation/error-handler.ts" #完了
          - "/components/translation/TranslationDisplay.tsx"
        technical_approach:
          - "モジュール分割アプローチによる責任の明確化" #完了
          - "共通型定義モジュールによる型安全性の確保" #完了
          - "正規表現を用いた余分なテキスト除去アルゴリズムの実装" #完了
          - "スライド単位での翻訳データ構造化" #完了
          - "エラー発生時の部分的な結果返却と再試行機能" #完了
          - "ユーザーフレンドリーなエラーメッセージの生成" #完了
          - "翻訳品質チェック機能の実装" #完了
          - "翻訳履歴と使用クレジットの管理機能強化" #完了
          - "翻訳APIルートのモジュール統合とリファクタリング" #完了
          - "柔軟なデータ形式対応とエラー表示の改善"
        potential_issues:
          - "異なるAI翻訳モデル間でのレスポンス形式の違い"
          - "特殊な言語ペアや専門用語を含むテキストの処理"
          - "長文や複雑なフォーマットのテキストの翻訳品質"
          - "エラー発生時のユーザー体験と復旧性"
        testing_strategy:
          - "様々な言語ペアとテキストタイプでの翻訳品質評価"
          - "エラーケースのシミュレーションと回復処理の検証"
          - "ユーザビリティテストとフィードバック収集"
        success_metrics:
          - "翻訳結果のクリーン度 > 99%（余分なテキストなし）"
          - "エラー発生時のユーザー満足度 > 4.0/5.0"
          - "データ構造の一貫性 100%"

    - id: performance_optimization
      description: "パフォーマンス最適化と大規模PPTX処理の改善"
      priority: medium
      depends_on: ["text_extraction_improvement"]
      phases:
        - phase_name: "ボトルネック分析"
          tasks:
            - "現在の処理時間とリソース使用量の計測"
            - "大規模PPTXファイルでのボトルネック特定"
            - "メモリ使用量と並行処理の可能性調査"
        - phase_name: "最適化実装"
          tasks:
            - "スライド処理の並行化とバッチ処理の実装"
            - "メモリ使用量の最適化とキャッシュ戦略の改善"
            - "プログレス表示とキャンセル機能の実装"
        - phase_name: "テストフェーズ"
          tasks:
            - "大規模PPTXファイルでのベンチマークテスト"
            - "メモリ使用量とCPU使用率のモニタリング"
            - "ユーザー体験と応答性の評価"
      subtasks:
        - description: "- [ ] スライド処理の並行化とバッチ処理の実装"
        - description: "- [ ] メモリ使用量の最適化と中間キャッシュの導入"
        - description: "- [ ] プログレス表示とキャンセル機能の実装"
      implementation_details:
        file_paths:
          - "/lib/pptx/parser.ts"
          - "/lib/python/pptx_parser.py"
          - "/app/api/pptx/parse/route.ts"
          - "/components/upload/ProgressBar.tsx"
        technical_approach:
          - "スライド処理の並行化（Worker Threadsやマルチプロセスの利用）"
          - "メモリ使用量の最適化（ストリーミング処理、メモリリーク防止）"
          - "中間結果のキャッシュと復元機能の実装"
          - "リアルタイムプログレス表示とキャンセル機能の実装"
        potential_issues:
          - "非同期処理とエラーハンドリングの複雑化"
          - "プロセス間通信とリソース管理の課題"
          - "キャンセル処理とリソースクリーンアップの課題"
          - "ブラウザとサーバー間のリアルタイム通信の課題"
        testing_strategy:
          - "様々なサイズのPPTXファイルでのベンチマークテスト"
          - "メモリ使用量とCPU使用率のモニタリング"
          - "キャンセル処理とリソース解放の検証"
          - "ユーザビリティテストとフィードバック収集"
        success_metrics:
          - "大規模PPTX処理時間 50% 削減"
          - "メモリ使用量 30% 削減"
          - "ユーザー満足度スコア > 4.5/5.0"

  implementation_guidelines:
    general_principles:
      - "モジュール化と責任の分離を徹底し、テスト容易性を確保する"
      - "型安全性を最大限に活用し、コンパイル時のエラー検出を強化する"
      - "エラーハンドリングを徹底し、ユーザー体験を損なわないようにする"
      - "パフォーマンスとユーザー体験のバランスを考慮する"
    error_prevention:
      - "境界条件（極端に長いテキスト、特殊文字など）の処理を明示的に実装"
      - "型定義を厳密に行い、nullやundefinedの扱いを明確にする"
      - "非同期処理のエラーハンドリングを徹底（try-catchの適切な使用）"
      - "デバッグログを戦略的に配置し、問題の早期発見を可能にする"
    code_quality:
      - "単一責任の原則に従ったクラス・関数設計"
      - "テスト駆動開発の採用（特に重要な機能）"
      - "コードレビューの徹底（特に複雑なアルゴリズム部分）"
      - "パフォーマンスボトルネックの早期特定と対策"
    deployment_strategy:
      - "段階的なロールアウト（A/Bテスト）"
      - "モニタリングとアラートの設定"
      - "ロールバック計画の準備"
      - "ユーザーフィードバックの収集体制の整備"
