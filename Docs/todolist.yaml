# パフォーマンス最適化 進捗状況とTODOリスト
performance_optimization:
  title: パフォーマンス最適化
  completed_items:
    - description: "- [x] PPTXパーサーの最適化"
      subtasks:
        - description: "- [x] キャッシュ機能の実装"
          subtasks:
            - description: "- [x] ファイルハッシュベースのキャッシュ"
            - description: "- [x] ハードリンクによるディスク使用量の最適化"
        - description: "- [x] LibreOffice変換の最適化"
          subtasks:
            - description: "- [x] 最適化されたPDF出力オプション"
            - description: "- [x] 環境変数の適切な設定"
        - description: "- [x] PDF→PNG変換の最適化"
          subtasks:
            - description: "- [x] 並列処理の導入"
            - description: "- [x] 出力フォーマットとDPIの最適化"
        - description: "- [x] パース処理の最適化"
          subtasks:
            - description: "- [x] 不要な中間ファイルの削除"
            - description: "- [x] エラーハンドリングの改善"
    - description: "- [x] ベンチマークスクリプトの基本実装"
      subtasks:
        - description: "- [x] 処理時間計測機能"
        - description: "- [x] ファイルサイズ情報収集"
        - description: "- [x] エラーケーステストの基本機能"
    - description: "- [x] ベンチマークテスト"
      subtasks:
        - description: "- [x] テストデータの準備"
          subtasks:
            - description: "- [x] 小規模PPTX（1-5スライド）"
            - description: "- [x] 中規模PPTX（10-20スライド）"
            - description: "- [x] 大規模PPTX（50+スライド）"
            - description: "- [x] 画像重視PPTX"
            - description: "- [x] テキスト重視PPTX"
        - description: "- [x] パフォーマンス計測の拡張"
          subtasks:
            - description: "- [x] 処理時間の計測"
            - description: "- [x] メモリ使用量の計測（psutilを使用）"
            - description: "- [x] CPU使用率の計測（psutilを使用）"
            - description: "- [x] ディスクI/Oの計測（psutilを使用）"
    - description: "- [x] エラーケーステスト"
      subtasks:
        - description: "- [x] 異常なPPTXファイルの処理"
          subtasks:
            - description: "- [x] 破損したPPTXファイル"
            - description: "- [x] 不正なフォーマット"
            - description: "- [x] 巨大なファイル"
        - description: "- [x] ネットワーク関連"
          subtasks:
            - description: "- [x] 遅延時の挙動確認"
            - description: "- [x] タイムアウト処理"
        - description: "- [x] リソース制限"
          subtasks:
            - description: "- [x] メモリ制限時の挙動"
            - description: "- [x] ディスク容量制限時の挙動"
            - description: "- [x] CPU負荷時の挙動"
    - description: "- [x] ドキュメント更新"
      subtasks:
        - description: "- [x] 機能ドキュメント"
        - description: "- [x] 運用ドキュメント"
        - description: "- [x] トラブルシューティング"
    - description: "- [x] 追加の最適化（必要に応じて）"
      subtasks:
        - description: "- [x] キャッシュ戦略の改善"
        - description: "- [x] 並列処理の最適化"
        - description: "- [x] メモリ使用量の最適化"
        - description: "- [x] エラーハンドリングの強化"
    - description: "- [x] テスト実行と検証"
      subtasks:
        - description: "- [x] エラーケーステストの実行"
        - description: "- [x] 統合テストの実行"
        - description: "- [x] 負荷テスト"
  ongoing_tasks:
    - description: "- [ ] PPTXパーサーの最適化（継続）"
      priority: high
    - description: "- [ ] スライドAPIの改善"
      priority: high
    - description: "- [ ] クエリパラメータによるサーバーサイドフィルタリング"
      priority: medium
    - description: "- [ ] PPTXファイル処理の速度・メモリ効率改善（API/フロント）" # 「今後のタスク」から移動
      priority: highest

# PPT翻訳アプリケーション タスクリスト
application_tasks:
  title: PPT翻訳アプリケーション タスクリスト
  completed_features:
    - description: "- [x] Python実装とDockerによるVercelデプロイ計画"
    - description: "- [x] 設定ファイルのCommonJS形式への統一と各種調整"
    - description: "- [x] APIとUIの改善"
      subtasks:
        - description: "- [x] APIルーティングのビルド状況ログ確認"
        - description: "- [x] API競合解消のためのRoute Handler移行"
        - description: "- [x] バッチワーカーのTSX統一（React Inkを使用したTUIツール）"
        - description: "- [x] formidable型定義の整備"
        - description: "- [x] UI・パフォーマンス改善（LazyImage, useQueryCache, フォントマッピングとテキストレイアウト調整）"
        - description: "- [x] フォントマッピングユーティリティ作成"
        - description: "- [x] テキストレイアウト調整ヘルパー関数"
    - description: "- [x] モジュール形式の問題解決 (ESM/CommonJS混在解消)"
    - description: "- [x] 翻訳履歴機能の拡張"
      subtasks:
        - description: "- [x] Prismaスキーマ修正・マイグレーション"
        - description: "- [x] /api/history API拡張"
        - description: "- [x] /api/history/[id] 詳細API新規作成"
        - description: "- [x] 履歴一覧UIの改善"
        - description: "- [x] 詳細表示機能の追加"
        - description: "- [x] フィルタリング・ソート機能の実装"
    - description: "- [x] テスト関連 (初期実装完了分)"
      subtasks:
        - description: "- [x] 認証テストの実装"
        - description: "- [x] テストデータの準備 (初期)"
        - description: "- [x] テスト環境の安定化 (初期)"
        - description: "- [x] UI要素の識別子追加 (初期)"
        - description: "- [x] 段階的テスト実装 (初期)"
        - description: "- [x] テスト実行環境の改善 (初期)"
        - description: "- [x] UIコンポーネントのユニットテスト追加 (Dialog, Textarea, Separator, Skeleton)"
        - description: "- [x] ユーティリティ関数のテスト追加 (activity-logger, file-utils)"
        - description: "- [x] API関連テスト追加 (history API)"
        - description: "- [x] フックテスト追加 (useApi, useIntersectionObserver)"
    - description: "- [x] ファイルアップロード機能 (基本)"
      subtasks:
        - description: "- [x] ドラッグ＆ドロップサポート"
        - description: "- [x] ファイル形式バリデーション"
        - description: "- [x] ファイルサイズ制限"
        - description: "- [x] アップロード進捗表示"
        - description: "- [x] エラーハンドリング"
    - description: "- [x] PPTXファイル処理エラー修正 (初期)"
      subtasks:
        - description: "- [x] クライアントとサーバー間のリクエストデータの不一致修正"

  # MVPに直結する機能と、それを支える基盤
  mvp_and_core_infrastructure:
    - description: "- [ ] 翻訳テキストの位置ずれ修正"
      priority: highest
      subtasks:
        - description: "- [ ] PPTX生成時のテキストボックス位置・サイズ・フォント・autofit等の再計算・調整"
        - description: "- [ ] PPTXジェネレーターの修正"
    - description: "- [ ] バッチ翻訳機能の実装"
      priority: high # MVP後だが重要
      subtasks:
        - description: "- [ ] 複数ファイルの一括アップロード"
        - description: "- [ ] バックグラウンド処理の実装"
        - description: "- [ ] 進捗状況の表示"

  # テストとCI/CD (品質と開発効率の担保)
  testing_and_cicd:
    title: テストとCI/CD
    - description: "- [x] テストカバレッジ向上"
      priority: high
      subtasks:
        - description: "- [x] SWCの設定最適化 (TypeScript, デコレータ, ダイナミックインポート, ソースマップ)"
        - description: "- [x] Jestの設定改善 (モジュールマッピング, カバレッジレポート, タイムアウト)"
        - description: "- [x] テスト実行スクリプトの整備 (カバレッジレポート生成, CI/CD用コマンド)"
    - description: "- [x] テスト実行時の型エラー解消"
      priority: highest
      subtasks:
        - description: "- [x] 型定義ファイルの作成"
          subtasks:
            - description: "- [x] jest-extended.d.ts: Jestのモック関数の型定義拡張"
            - description: "- [x] jest-custom-matchers.d.ts: カスタムマッチャーの型定義"
            - description: "- [x] next-auth-mock.d.ts: NextAuthのモック関連の型定義"
            - description: "- [x] next-api-mock.d.ts: Next.jsのAPIルート関連の型定義"
            - description: "- [x] test-factories.d.ts: テストファクトリーの型定義"
            - description: "- [x] global-test-helpers.d.ts: グローバルテストヘルパーの型定義"
            - description: "- [x] jest-expect-extend.d.ts: expect.extendの型定義拡張"
        - description: "- [x] モックセットアップの改善"
          subtasks:
            - description: "- [x] mockSetup.ts: モック関数の作成方法を改善"
            - description: "- [x] setupMocks.ts: 共通のモック設定を一元管理"
        - description: "- [x] カスタムマッチャーの実装"
          subtasks:
            - description: "- [x] apiMatchers.ts: APIレスポンス検証用のカスタムマッチャー"
            - description: "- [x] modelMatchers.ts: モデル検証用のカスタムマッチャー"
        - description: "- [x] Jest設定の更新"
          subtasks:
            - description: "- [x] jest.config.js: マージ競合を解決し、最適な設定に更新"
            - description: "- [x] jest.setup.js: カスタムマッチャーを自動的に読み込むように設定"
    - description: "- [x] テストデータ管理の整備"
      priority: highest
      subtasks:
        - description: "- [x] テストデータファクトリーの実装"
          subtasks:
            - description: "- [x] ユーザーデータファクトリー"
            - description: "- [x] 翻訳履歴データファクトリー"
            - description: "- [x] クレジットログファクトリー"
            - description: "- [x] アクティビティログファクトリー"
        - description: "- [x] テスト用DBセットアップの自動化"
          subtasks:
            - description: "- [x] マイグレーションスクリプトの最適化"
            - description: "- [x] シードデータの自動投入"
            - description: "- [x] テスト後のクリーンアップ処理"
        - description: "- [x] モックデータの整備"
          subtasks:
            - description: "- [x] PPTXファイルのモックデータ"
            - description: "- [x] APIレスポンスのモックデータ"
            - description: "- [x] 外部サービス連携のモックデータ"
    - description: "- [x] ファクトリーを使用したテストケースの実装"
      priority: high
      subtasks:
        - description: "- [x] ユーザー管理APIテスト"
          subtasks:
            - description: "- [x] ユーザー作成テスト"
            - description: "- [x] ユーザー更新テスト"
            - description: "- [x] ユーザー削除テスト"
        - description: "- [x] 翻訳履歴APIテスト"
          subtasks:
            - description: "- [x] 履歴作成テスト"
            - description: "- [x] 履歴一覧取得テスト"
            - description: "- [x] 履歴詳細取得テスト"
        - description: "- [x] クレジット管理APIテスト"
          subtasks:
            - description: "- [x] クレジット付与テスト"
            - description: "- [x] クレジット消費テスト"
            - description: "- [x] クレジット履歴テスト"
        - description: "- [x] アクティビティログAPIテスト"
          subtasks:
            - description: "- [x] ログ記録テスト"
            - description: "- [x] ログ取得テスト"
            - description: "- [x] ログフィルタリングテスト"
    - description: "- [ ] CI/CD統合と環境整備"
      priority: highest
      subtasks:
        - description: "- [x] テスト実行環境の整備"
          subtasks:
            - description: "- [x] Jest設定の最適化"
            - description: "- [x] Cypress設定の最適化"
            - description: "- [x] テストレポート生成の設定"
        - description: "- [x] テストスクリプトの整備"
          subtasks:
            - description: "- [x] ユニットテスト実行コマンド"
            - description: "- [x] E2Eテスト実行コマンド"
            - description: "- [x] カバレッジレポート生成コマンド"
        - description: "- [ ] GitHub Actionsワークフロー設定（進行中）"
          subtasks:
            - description: "- [x] プレビューデプロイの自動化"
              subtasks:
                - description: "- [x] Vercel CLIを使用したデプロイスクリプト"
                - description: "- [x] デプロイURLのPRコメント自動投稿"
                - description: "- [x] Slack通知の設定"
            - description: "- [ ] テスト自動化の実装"
              priority: highest
              subtasks:
                - description: "- [ ] ユニットテストワークフロー"
                - description: "- [ ] E2Eテストワークフロー"
            - description: "- [ ] コード品質チェックの導入"
              priority: high
              subtasks:
                - description: "- [ ] ESLint実行設定"
                - description: "- [ ] Prettier実行設定"
                - description: "- [ ] TypeScript型チェック"
                - description: "- [ ] パフォーマンスチェック"
            - description: "- [ ] ステージング環境の設定準備"
              priority: high
              subtasks:
                - description: "- [ ] Vercel Stagingプロジェクト作成"
                - description: "- [ ] デプロイメントワークフロー"
                - description: "- [ ] データベース環境の準備"
                - description: "- [ ] モニタリングの設定"
        - description: "- [x] テストデータベース環境の構築"
          subtasks:
            - description: "- [x] テスト用PostgreSQLコンテナの設定"
            - description: "- [x] 環境変数の設定"
            - description: "- [x] マイグレーション自動実行の設定"
        - description: "- [ ] テスト実行の最適化"
          subtasks:
            - description: "- [ ] 並列実行の設定"
            - description: "- [ ] キャッシュの活用"
            - description: "- [ ] テスト実行時間の短縮"

  # 既存テストファイル改善計画
  test_improvement_plan:
    title: 既存テストファイル改善計画
    description: 既存のテストファイルを改善し、より堅牢なテストを実装する
    note: この改善計画は現段階ではMVPとして必要以上である可能性があります。プロダクトのリリーススケジュールに影響しない範囲で実施することを推奨します。
    - description: "- [ ] APIエンドポイントテストの強化"
      priority: high
      subtasks:
        - description: "- [ ] 認証失敗ケースのテスト拡充"
        - description: "- [ ] レートリミットテストの実装"
        - description: "- [ ] 無効なリクエストパラメータのテスト拡充"
        - description: "- [ ] データベースエラーハンドリングのテスト"
      target_files:
        - description: "- tests/api/translate/route.test.ts"
        - description: "- tests/api/upload/route.test.ts"
        - description: "- tests/api/auth/*.test.ts"
    - description: "- [ ] フックテストの拡充"
      priority: medium
      subtasks:
        - description: "- [ ] データ取得フックのテスト拡充"
        - description: "- [ ] エラーハンドリングのテスト強化"
        - description: "- [ ] 非同期処理のテスト改善"
      target_files:
        - description: "- tests/hooks/useTranslation.test.tsx"
        - description: "- tests/hooks/useActivityLogs.test.tsx"
        - description: "- tests/hooks/useFileUpload.test.tsx"
    - description: "- [x] コンポーネントテストの改善"
      priority: medium
      subtasks:
        - description: "- [x] カスタムマッチャーを使用したテストの書き換え (一部完了)"
        - description: "- [x] モックセットアップの改善 (一部完了)"
        - description: "- [x] イベントハンドリングのテスト強化 (一部完了)"
        - description: "- [x] Selectコンポーネントのテスト修正 (完了)"
        - description: "- [x] 翻訳処理のキャンセル機能テストの改善 (完了)"
      target_files:
        - description: "- tests/components/ui/*.test.tsx (Button, Input, Textarea, Label, Switch, Select, Dialog, DropdownMenu, Card, Alert, Avatar, Skeleton, Separator完了)"
        - description: "- tests/components/form/*.test.tsx"
        - description: "- tests/components/layout/*.test.tsx"
      completed_tasks:
        - description: "- [x] Buttonコンポーネントのテスト改善"
        - description: "- [x] Inputコンポーネントのテスト改善"
        - description: "- [x] Textareaコンポーネントのテスト改善"
        - description: "- [x] Labelコンポーネントのテスト改善"
        - description: "- [x] Switchコンポーネントのテスト改善"
        - description: "- [x] Selectコンポーネントのテスト改善"
        - description: "- [x] Dialogコンポーネントのテスト改善"
        - description: "- [x] DropdownMenuコンポーネントのテスト改善"
        - description: "- [x] Cardコンポーネントのテスト改善"
        - description: "- [x] Alertコンポーネントのテスト改善"
        - description: "- [x] Avatarコンポーネントのテスト改墄"
        - description: "- [x] Skeletonコンポーネントのテスト改墄"
        - description: "- [x] Separatorコンポーネントのテスト改墄"
    - description: "- [ ] ユーティリティ関数テストの拡充"
      priority: low
      subtasks:
        - description: "- [ ] ファイル操作ユーティリティのテスト拡充"
        - description: "- [ ] 日付・時間操作関数のテスト拡充"
        - description: "- [ ] バリデーション関数のテスト拡充"
      target_files:
        - description: "- tests/utils/file.test.ts"
        - description: "- tests/utils/date.test.ts"
        - description: "- tests/utils/validation.test.ts"
    - description: "- [ ] 実装スケジュール"
      subtasks:
        - description: "- [ ] 開始予定日: 2025-05-20"
        - description: "- [ ] 完了予定日: 2025-06-10"

  # その他の機能拡張
  additional_features:
    title: その他の機能拡張
    - description: "- [ ] API連携機能の実装"
      priority: medium
      subtasks:
        - description: "- [ ] 外部サービスとの連携インターフェース"
        - description: "- [ ] APIキー管理"
        - description: "- [ ] 使用量の監視"
    - description: "- [ ] 請求書生成機能の実装"
      priority: medium
      subtasks:
        - description: "- [ ] 請求書テンプレートの作成"
        - description: "- [ ] PDF生成機能"
        - description: "- [ ] メール送信機能"
    - description: "- [ ] 統計・分析機能の実装"
      priority: medium
      subtasks:
        - description: "- [ ] 使用状況ダッシュボード"
        - description: "- [ ] グラフ表示"
        - description: "- [ ] エクスポート機能"
    - description: "- [ ] RLS（Row Level Security）の実装"
      priority: medium 
      subtasks:
        - description: "- [ ] テーブルごとのポリシー設定"
        - description: "- [ ] ロールベースのアクセス制御"
        - description: "- [ ] 監査ログの自動記録"
    - description: "- [ ] モバイル対応テスト"
      priority: medium
      subtasks:
        - description: "- [ ] レスポンシブデザインのテスト"
        - description: "- [ ] タッチ操作のテスト"
        - description: "- [ ] モバイル特有の問題の検出"
    - description: "- [ ] Supabase連携計画"
      priority: high
      subtasks:
        - description: "- [ ] Phase 1 - 基本設定とデータベース移行 (プロジェクトセットアップ, スキーマ移行, 認証連携)"
        - description: "- [ ] Phase 2 - ストレージとRLS実装 (ファイルストレージ設定, RLSポリシー実装)"
        - description: "- [ ] Phase 3 - リアルタイム機能と最適化 (リアルタイム更新, エッジ関数活用)"
    - description: "- [ ] ブログ機能の実装"
      priority: low
    - description: "- [ ] 多言語対応の拡充"
      priority: low
    - description: "- [ ] カスタムテーマ機能"
      priority: low
    - description: "- [ ] APIドキュメントの整備 (Swagger/OpenAPI)"
      priority: low