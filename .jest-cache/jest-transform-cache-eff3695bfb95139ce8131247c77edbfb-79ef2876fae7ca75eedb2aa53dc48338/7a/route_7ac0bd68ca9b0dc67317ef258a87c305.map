{"version":3,"sources":["/Users/yusuketsunoda/Documents/cursor/ppttranslatorapp/worktrees/cicd-setup/app/api/user/credits/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth/auth-options';\nimport { prisma } from '@/lib/db/prisma';\n\nexport const dynamic = 'force-dynamic';\n\n/**\n * ユーザーのクレジット残高を取得するAPI\n */\nexport async function GET() {\n  try {\n    // セッションからユーザー情報を取得\n    const session = await getServerSession(authOptions);\n\n    // 未認証の場合はエラー\n    if (!session || !session.user) {\n      return NextResponse.json(\n        { error: '認証が必要です' },\n        { status: 401 }\n      );\n    }\n\n    // ユーザーIDを取得\n    const userId = session.user.id;\n\n    // ユーザー情報を取得\n    const user = await prisma.user.findUnique({\n      where: { id: userId },\n      select: { credits: true }\n    });\n\n    // ユーザーが見つからない場合はエラー\n    if (!user) {\n      return NextResponse.json(\n        { error: 'ユーザーが見つかりません' },\n        { status: 404 }\n      );\n    }\n\n    // クレジット残高を返す（クレジットが0以下の場合は0を返す）\n    const credits = user.credits > 0 ? user.credits : 0;\n    return NextResponse.json({ credits });\n  } catch (error) {\n    console.error('クレジット残高取得エラー:', error);\n    return NextResponse.json(\n      { error: 'クレジット残高の取得に失敗しました' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","dynamic","session","getServerSession","authOptions","user","NextResponse","json","error","status","userId","id","prisma","findUnique","where","select","credits","console"],"mappings":";;;;;;;;;;;IAUsBA,GAAG;eAAHA;;IALTC,OAAO;eAAPA;;;wBALgB;0BACI;6BACL;wBACL;AAEhB,MAAMA,UAAU;AAKhB,eAAeD;IACpB,IAAI;QACF,mBAAmB;QACnB,MAAME,UAAU,MAAMC,IAAAA,0BAAgB,EAACC,wBAAW;QAElD,aAAa;QACb,IAAI,CAACF,WAAW,CAACA,QAAQG,IAAI,EAAE;YAC7B,OAAOC,oBAAY,CAACC,IAAI,CACtB;gBAAEC,OAAO;YAAU,GACnB;gBAAEC,QAAQ;YAAI;QAElB;QAEA,YAAY;QACZ,MAAMC,SAASR,QAAQG,IAAI,CAACM,EAAE;QAE9B,YAAY;QACZ,MAAMN,OAAO,MAAMO,cAAM,CAACP,IAAI,CAACQ,UAAU,CAAC;YACxCC,OAAO;gBAAEH,IAAID;YAAO;YACpBK,QAAQ;gBAAEC,SAAS;YAAK;QAC1B;QAEA,oBAAoB;QACpB,IAAI,CAACX,MAAM;YACT,OAAOC,oBAAY,CAACC,IAAI,CACtB;gBAAEC,OAAO;YAAe,GACxB;gBAAEC,QAAQ;YAAI;QAElB;QAEA,gCAAgC;QAChC,MAAMO,UAAUX,KAAKW,OAAO,GAAG,IAAIX,KAAKW,OAAO,GAAG;QAClD,OAAOV,oBAAY,CAACC,IAAI,CAAC;YAAES;QAAQ;IACrC,EAAE,OAAOR,OAAO;QACdS,QAAQT,KAAK,CAAC,iBAAiBA;QAC/B,OAAOF,oBAAY,CAACC,IAAI,CACtB;YAAEC,OAAO;QAAoB,GAC7B;YAAEC,QAAQ;QAAI;IAElB;AACF"}