{"version":3,"sources":["/Users/yusuketsunoda/Documents/cursor/ppttranslatorapp/worktrees/cicd-setup/tests/lib/pptx/parser.test.ts"],"sourcesContent":["/// <reference path=\"../../jest.d.ts\" />\n\nimport { PPTXParser } from '@/lib/pptx/parser';\nimport fs from 'fs';\nimport path from 'path';\nimport { PythonShell } from 'python-shell';\nimport { SlideContent } from '@/lib/pptx/types';\n\n// モックの設定\njest.mock('fs', () => ({\n  readFileSync: jest.fn(),\n  existsSync: jest.fn().mockReturnValue(true),\n  mkdirSync: jest.fn(),\n  writeFileSync: jest.fn(),\n  promises: {\n    access: jest.fn().mockResolvedValue(undefined),\n  },\n}));\n\njest.mock('fs/promises', () => ({\n  access: jest.fn().mockResolvedValue(undefined),\n  writeFile: jest.fn().mockResolvedValue(undefined),\n  readFile: jest.fn().mockResolvedValue(Buffer.from('mock file data')),\n}));\n\njest.mock('path', () => ({\n  join: jest.fn().mockImplementation((...args) => args.join('/')),\n  dirname: jest.fn().mockReturnValue('/mock/dir'),\n  basename: jest.fn().mockImplementation((path, ext) => (ext ? 'test' : 'pptx_parser.py')),\n}));\n\n// PythonShellモック\njest.mock('python-shell', () => {\n  const mockStream = {\n    write: jest.fn(),\n    end: jest.fn(),\n    on: jest.fn(),\n    removeListener: jest.fn(),\n    pipe: jest.fn(),\n    unpipe: jest.fn(),\n  };\n\n  const defaultImplementation = {\n    on: jest.fn().mockImplementation((event, callback) => {\n      if (event === 'message') {\n        callback(\n          JSON.stringify({\n            slides: [\n              {\n                index: 0,\n                image_path: 'slide_1.png',\n                texts: ['テストテキスト1'],\n                positions: [{ x: 100, y: 100, width: 200, height: 50 }],\n              },\n            ],\n          }),\n        );\n      }\n      return { on: jest.fn() };\n    }),\n    end: jest.fn().mockImplementation((callback) => {\n      callback(null);\n    }),\n    scriptPath: '',\n    command: 'python3',\n    mode: 'json',\n    formatter: null,\n    pythonPath: 'python3',\n    pythonOptions: [],\n    scriptArgs: [],\n    stdoutParser: jest.fn(),\n    stderrParser: jest.fn(),\n    terminated: false,\n    childProcess: null,\n    parser: jest.fn(),\n    stdin: mockStream,\n    stdout: mockStream,\n    stderr: mockStream,\n    exitSignal: null,\n    exitCode: 0,\n    stderrHasEnded: false,\n    stdoutHasEnded: false,\n    send: jest.fn(),\n    kill: jest.fn(),\n    terminate: jest.fn(),\n    _remaining: '',\n    _endCallback: null,\n    parseError: null,\n    addListener: jest.fn(),\n    removeAllListeners: jest.fn(),\n    setMaxListeners: jest.fn(),\n    getMaxListeners: jest.fn(),\n    listeners: jest.fn(),\n    rawListeners: jest.fn(),\n    emit: jest.fn(),\n    listenerCount: jest.fn(),\n    prependListener: jest.fn(),\n    prependOnceListener: jest.fn(),\n    eventNames: jest.fn(),\n    once: jest.fn(),\n    off: jest.fn(),\n  } as unknown as PythonShell;\n\n  return {\n    PythonShell: jest.fn().mockImplementation(() => defaultImplementation),\n  };\n});\n\njest.mock('child_process', () => {\n  const mockExec = jest.fn().mockImplementation((cmd, callback) => {\n    if (cmd === 'python3 --version') {\n      callback(null, { stdout: 'Python 3.11.0\\n' });\n    } else {\n      callback(null, { stdout: 'All dependencies are installed\\n' });\n    }\n  });\n  return {\n    exec: mockExec,\n    promisify: jest.fn().mockImplementation((fn) => {\n      return () => Promise.resolve({ stdout: 'Python 3.11.0\\n' });\n    }),\n  };\n});\n\ndescribe('PPTXパーサー', () => {\n  let parser: PPTXParser;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    parser = PPTXParser.getInstance();\n  });\n\n  describe('parsePPTX', () => {\n    it('PPTXファイルを正しくパースする', async () => {\n      // fs.existsSyncがtrueを返すようにモック\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      const result = await parser.parsePPTX('test.pptx', '/tmp');\n\n      expect(result).toBeDefined();\n      expect(result.slides).toHaveLength(1);\n      expect(result.slides[0].textElements[0].text).toBe('テストテキスト1');\n      expect(result.slides[0].imagePath).toBe('slide_1.png');\n    });\n\n    it('Pythonスクリプトが見つからない場合はエラーを投げる', async () => {\n      // fs.existsSyncを一時的にfalseを返すように設定\n      const existsSyncMock = jest\n        .fn()\n        .mockReturnValueOnce(false) // 最初の呼び出しでfalse\n        .mockReturnValue(true); // その後の呼び出しではtrue\n      (fs.existsSync as jest.Mock).mockImplementation(existsSyncMock);\n\n      await expect(parser.parsePPTX('test.pptx', '/tmp')).rejects.toThrow('Python script not found');\n      expect(existsSyncMock).toHaveBeenCalled();\n    });\n\n    it('Pythonスクリプトの実行エラーを適切に処理する', async () => {\n      // fs.existsSyncがtrueを返すように設定\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      const mockStream = {\n        write: jest.fn(),\n        end: jest.fn(),\n        on: jest.fn(),\n        removeListener: jest.fn(),\n        pipe: jest.fn(),\n        unpipe: jest.fn(),\n      };\n\n      // PythonShellのモックを一時的にエラーを返すように設定\n      const errorImplementation = {\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'stderr') {\n            callback('Python execution error');\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => {\n          callback(new Error('Python execution error'));\n        }),\n        scriptPath: '',\n        command: 'python3',\n        mode: 'json',\n        formatter: null,\n        pythonPath: 'python3',\n        pythonOptions: [],\n        scriptArgs: [],\n        stdoutParser: jest.fn(),\n        stderrParser: jest.fn(),\n        terminated: false,\n        childProcess: null,\n        parser: jest.fn(),\n        stdin: mockStream,\n        stdout: mockStream,\n        stderr: mockStream,\n        exitSignal: null,\n        exitCode: 1,\n        stderrHasEnded: true,\n        stdoutHasEnded: true,\n        send: jest.fn(),\n        kill: jest.fn(),\n        terminate: jest.fn(),\n        _remaining: '',\n        _endCallback: null,\n        parseError: null,\n        addListener: jest.fn(),\n        removeAllListeners: jest.fn(),\n        setMaxListeners: jest.fn(),\n        getMaxListeners: jest.fn(),\n        listeners: jest.fn(),\n        rawListeners: jest.fn(),\n        emit: jest.fn(),\n        listenerCount: jest.fn(),\n        prependListener: jest.fn(),\n        prependOnceListener: jest.fn(),\n        eventNames: jest.fn(),\n        once: jest.fn(),\n        off: jest.fn(),\n      } as unknown as PythonShell;\n\n      jest.mocked(PythonShell).mockImplementationOnce(() => errorImplementation);\n\n      await expect(parser.parsePPTX('test.pptx', '/tmp')).rejects.toThrow('Python execution error');\n    });\n\n    it('複雑なスライドレイアウトを正しく解析する', async () => {\n      // fs.existsSyncがtrueを返すように設定\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      // 複雑なレイアウトのモックデータを設定\n      const mockPythonShell = {\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'message') {\n            callback(JSON.stringify({\n              slides: [{\n                index: 0,\n                image_path: 'slide_1.png',\n                texts: [\n                  {\n                    text: 'タイトル',\n                    type: 'title',\n                    position: { x: 100, y: 50, width: 400, height: 100 },\n                    font: { name: 'Arial', size: 44, color: '#000000' }\n                  },\n                  {\n                    text: '本文テキスト',\n                    type: 'body',\n                    position: { x: 100, y: 200, width: 300, height: 150 },\n                    font: { name: 'MS Gothic', size: 24, color: '#333333' }\n                  }\n                ],\n                shapes: [\n                  { type: 'rectangle', x: 50, y: 30, width: 500, height: 140 },\n                  { type: 'circle', x: 450, y: 200, radius: 50 }\n                ],\n                background: { color: '#FFFFFF', image: null }\n              }]\n            }));\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => callback(null))\n      };\n\n      (PythonShell as jest.Mock).mockImplementation(() => mockPythonShell);\n\n      const result = await parser.parsePPTX('test.pptx', '/tmp');\n\n      expect(result).toBeDefined();\n      expect(result.slides).toHaveLength(1);\n      expect(result.slides[0].textElements).toHaveLength(2);\n      expect(result.slides[0].textElements[0].text).toBe('タイトル');\n      expect(result.slides[0].textElements[0].type).toBe('title');\n      expect(result.slides[0].textElements[0].position).toEqual({ x: 100, y: 50, width: 400, height: 100 });\n      expect(result.slides[0].shapes).toHaveLength(2);\n      expect(result.slides[0].background).toEqual({ color: '#FFFFFF', image: null });\n    });\n\n    it('メタデータを正しく抽出する', async () => {\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      const mockPythonShell = {\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'message') {\n            callback(JSON.stringify({\n              metadata: {\n                title: 'テストプレゼンテーション',\n                author: 'テストユーザー',\n                created: '2024-03-20T10:00:00Z',\n                modified: '2024-03-21T15:30:00Z',\n                company: 'テスト株式会社',\n                version: '1.0',\n                lastModifiedBy: '更新者',\n                revision: 5,\n                subject: 'テストサブジェクト',\n                keywords: ['キーワード1', 'キーワード2'],\n                category: 'テストカテゴリ',\n                description: 'テスト説明',\n                language: 'ja-JP',\n                presentationFormat: 'widescreen',\n                createdApplication: 'Microsoft PowerPoint'\n              },\n              slides: [{\n                index: 0,\n                image_path: 'slide_1.png',\n                texts: ['テストテキスト1'],\n                positions: [{ x: 100, y: 100, width: 200, height: 50 }]\n              }]\n            }));\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => callback(null))\n      };\n\n      (PythonShell as jest.Mock).mockImplementation(() => mockPythonShell);\n\n      const result = await parser.parsePPTX('test.pptx', '/tmp');\n\n      expect(result.metadata).toBeDefined();\n      expect(result.metadata.title).toBe('テストプレゼンテーション');\n      expect(result.metadata.author).toBe('テストユーザー');\n      expect(result.metadata.created).toBe('2024-03-20T10:00:00Z');\n      expect(result.metadata.modified).toBe('2024-03-21T15:30:00Z');\n      expect(result.metadata.company).toBe('テスト株式会社');\n      expect(result.metadata.version).toBe('1.0');\n      expect(result.metadata.lastModifiedBy).toBe('更新者');\n      expect(result.metadata.revision).toBe(5);\n      expect(result.metadata.subject).toBe('テストサブジェクト');\n      expect(result.metadata.keywords).toEqual(['キーワード1', 'キーワード2']);\n      expect(result.metadata.category).toBe('テストカテゴリ');\n      expect(result.metadata.description).toBe('テスト説明');\n      expect(result.metadata.language).toBe('ja-JP');\n      expect(result.metadata.presentationFormat).toBe('widescreen');\n      expect(result.metadata.createdApplication).toBe('Microsoft PowerPoint');\n    });\n\n    it('特殊なテキスト形式を正しく処理する', async () => {\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      const mockPythonShell = {\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'message') {\n            callback(JSON.stringify({\n              slides: [{\n                index: 0,\n                image_path: 'slide_1.png',\n                texts: [\n                  {\n                    text: '太字とイタリック',\n                    type: 'body',\n                    position: { x: 100, y: 100, width: 200, height: 50 },\n                    font: { name: 'Arial', size: 24, bold: true, italic: true }\n                  },\n                  {\n                    text: '下線付きテキスト',\n                    type: 'body',\n                    position: { x: 100, y: 150, width: 200, height: 50 },\n                    font: { name: 'Arial', size: 24, underline: true }\n                  },\n                  {\n                    text: 'カラーテキスト',\n                    type: 'body',\n                    position: { x: 100, y: 200, width: 200, height: 50 },\n                    font: { name: 'Arial', size: 24, color: '#FF0000' }\n                  }\n                ]\n              }]\n            }));\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => callback(null))\n      };\n\n      (PythonShell as jest.Mock).mockImplementation(() => mockPythonShell);\n\n      const result = await parser.parsePPTX('test.pptx', '/tmp');\n\n      expect(result.slides[0].textElements).toHaveLength(3);\n      expect(result.slides[0].textElements[0].font.bold).toBe(true);\n      expect(result.slides[0].textElements[0].font.italic).toBe(true);\n      expect(result.slides[0].textElements[1].font.underline).toBe(true);\n      expect(result.slides[0].textElements[2].font.color).toBe('#FF0000');\n    });\n\n    it('大量のスライドを含むPPTXを正しく処理する', async () => {\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      const mockSlides = Array.from({ length: 50 }, (_, i) => ({\n        index: i,\n        image_path: `slide_${i + 1}.png`,\n        texts: [`スライド${i + 1}のテキスト`],\n        positions: [{ x: 100, y: 100, width: 200, height: 50 }]\n      }));\n\n      const mockPythonShell = {\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'message') {\n            callback(JSON.stringify({ slides: mockSlides }));\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => callback(null))\n      };\n\n      (PythonShell as jest.Mock).mockImplementation(() => mockPythonShell);\n\n      const result = await parser.parsePPTX('test.pptx', '/tmp');\n\n      expect(result.slides).toHaveLength(50);\n      expect(result.slides[49].textElements[0].text).toBe('スライド50のテキスト');\n      expect(result.slides[49].imagePath).toBe('slide_50.png');\n    });\n\n    it('無効なファイル形式を適切に処理する', async () => {\n      // PythonShellのモックを一時的にエラーを返すように設定\n      (PythonShell as jest.Mock).mockImplementation(() => ({\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'stderr') {\n            callback('Invalid file format: File is not a valid PPTX file');\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => {\n          callback(new Error('Invalid file format'));\n        })\n      }));\n\n      await expect(parser.parsePPTX('invalid.pptx', '/tmp')).rejects.toThrow('Invalid file format');\n    });\n\n    it('破損したファイルを適切に処理する', async () => {\n      // PythonShellのモックを一時的にエラーを返すように設定\n      (PythonShell as jest.Mock).mockImplementation(() => ({\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'stderr') {\n            callback('Corrupted PPTX file: Unable to read file structure');\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => {\n          callback(new Error('Corrupted PPTX file'));\n        })\n      }));\n\n      await expect(parser.parsePPTX('corrupted.pptx', '/tmp')).rejects.toThrow('Corrupted PPTX file');\n    });\n\n    it('特殊なレイアウトを含むスライドを正しく処理する', async () => {\n      const specialLayoutData = {\n        slides: [\n          {\n            index: 0,\n            image_path: 'slide_1.png',\n            texts: [\n              {\n                text: '縦書きテキスト',\n                position: { x: 50, y: 50, width: 100, height: 400 },\n                type: 'vertical',\n                paragraphs: [{ font: { name: 'MS Mincho', size: 24, color: '#000000' } }]\n              },\n              {\n                text: '回転テキスト',\n                position: { x: 200, y: 100, width: 200, height: 50 },\n                type: 'rotated',\n                rotation: 45,\n                paragraphs: [{ font: { name: 'Arial', size: 20, color: '#333333' } }]\n              },\n              {\n                text: 'テーブルセル',\n                position: { x: 300, y: 200, width: 100, height: 50 },\n                type: 'table_cell',\n                table_info: { row: 0, col: 0 },\n                paragraphs: [{ font: { name: 'MS Gothic', size: 16, color: '#666666' } }]\n              }\n            ]\n          }\n        ]\n      };\n\n      // PythonShellのモックを一時的に変更\n      (PythonShell as jest.Mock).mockImplementation(() => ({\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'message') {\n            callback(JSON.stringify(specialLayoutData));\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => {\n          callback(null);\n        })\n      }));\n\n      const result = await parser.parsePPTX('special_layout.pptx', '/tmp');\n\n      // 特殊なレイアウト要素を検証\n      expect(result.slides[0].textElements).toHaveLength(3);\n      \n      // 縦書きテキストを検証\n      const verticalText = result.slides[0].textElements[0];\n      expect(verticalText.text).toBe('縦書きテキスト');\n      expect(verticalText.type).toBe('vertical');\n      expect(verticalText.position.height).toBe(400);\n      expect(verticalText.fontInfo.name).toBe('MS Mincho');\n\n      // 回転テキストを検証\n      const rotatedText = result.slides[0].textElements[1];\n      expect(rotatedText.text).toBe('回転テキスト');\n      expect(rotatedText.type).toBe('rotated');\n      expect(rotatedText.rotation).toBe(45);\n\n      // テーブルセルを検証\n      const tableCell = result.slides[0].textElements[2];\n      expect(tableCell.text).toBe('テーブルセル');\n      expect(tableCell.type).toBe('table_cell');\n      expect(tableCell.table_info).toEqual({ row: 0, col: 0 });\n    });\n\n    it('複雑なテキストスタイルを正しく処理する', async () => {\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      const mockPythonShell = {\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'message') {\n            callback(JSON.stringify({\n              slides: [{\n                index: 0,\n                image_path: 'slide_1.png',\n                texts: [\n                  {\n                    text: '太字とイタリック',\n                    type: 'body',\n                    position: { x: 100, y: 100, width: 200, height: 50 },\n                    font: {\n                      name: 'Arial',\n                      size: 24,\n                      color: '#FF0000',\n                      bold: true,\n                      italic: true,\n                      underline: false,\n                      strikethrough: false,\n                      superscript: false,\n                      subscript: false,\n                      characterSpacing: 1.2,\n                      kerning: true\n                    },\n                    style: {\n                      alignment: 'center',\n                      lineSpacing: 1.5,\n                      indentation: 20,\n                      direction: 'ltr',\n                      bulletStyle: {\n                        type: 'bullet',\n                        format: '•'\n                      }\n                    }\n                  }\n                ]\n              }]\n            }));\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => callback(null))\n      };\n\n      (PythonShell as jest.Mock).mockImplementation(() => mockPythonShell);\n\n      const result = await parser.parsePPTX('test.pptx', '/tmp');\n\n      const textElement = result.slides[0].textElements[0];\n      expect(textElement.font.bold).toBe(true);\n      expect(textElement.font.italic).toBe(true);\n      expect(textElement.font.color).toBe('#FF0000');\n      expect(textElement.font.characterSpacing).toBe(1.2);\n      expect(textElement.style?.alignment).toBe('center');\n      expect(textElement.style?.lineSpacing).toBe(1.5);\n      expect(textElement.style?.indentation).toBe(20);\n      expect(textElement.style?.bulletStyle?.type).toBe('bullet');\n    });\n\n    it('シェイプと背景を正しく処理する', async () => {\n      (fs.existsSync as jest.Mock).mockReturnValue(true);\n\n      const mockPythonShell = {\n        on: jest.fn().mockImplementation((event, callback) => {\n          if (event === 'message') {\n            callback(JSON.stringify({\n              slides: [{\n                index: 0,\n                image_path: 'slide_1.png',\n                shapes: [\n                  {\n                    type: 'RECTANGLE',\n                    x: 100,\n                    y: 100,\n                    width: 200,\n                    height: 150,\n                    rotation: 45,\n                    fillColor: '#FF0000',\n                    strokeColor: '#000000',\n                    strokeWidth: 2,\n                    opacity: 0.8\n                  },\n                  {\n                    type: 'OVAL',\n                    x: 300,\n                    y: 200,\n                    width: 100,\n                    height: 100,\n                    rotation: 0,\n                    fillColor: '#0000FF',\n                    strokeColor: '#000000',\n                    strokeWidth: 1,\n                    opacity: 1,\n                    radius: 50\n                  }\n                ],\n                background: {\n                  color: '#FFFFFF',\n                  image: null,\n                  pattern: null,\n                  gradient: {\n                    type: 'linear',\n                    stops: [\n                      { position: 0, color: '#FF0000' },\n                      { position: 1, color: '#0000FF' }\n                    ],\n                    angle: 45\n                  },\n                  transparency: 0.1\n                }\n              }]\n            }));\n          }\n          return { on: jest.fn() };\n        }),\n        end: jest.fn().mockImplementation((callback) => callback(null))\n      };\n\n      (PythonShell as jest.Mock).mockImplementation(() => mockPythonShell);\n\n      const result = await parser.parsePPTX('test.pptx', '/tmp');\n\n      const slide = result.slides[0];\n      expect(slide.shapes).toHaveLength(2);\n      \n      // 四角形の検証\n      const rectangle = slide.shapes[0];\n      expect(rectangle.type).toBe('RECTANGLE');\n      expect(rectangle.rotation).toBe(45);\n      expect(rectangle.fillColor).toBe('#FF0000');\n      expect(rectangle.opacity).toBe(0.8);\n\n      // 円の検証\n      const circle = slide.shapes[1];\n      expect(circle.type).toBe('OVAL');\n      expect(circle.radius).toBe(50);\n      expect(circle.fillColor).toBe('#0000FF');\n\n      // 背景の検証\n      const background = slide.background;\n      expect(background.color).toBe('#FFFFFF');\n      expect(background.gradient?.type).toBe('linear');\n      expect(background.gradient?.stops).toHaveLength(2);\n      expect(background.transparency).toBe(0.1);\n    });\n  });\n\n  describe('extractTexts', () => {\n    it('パース結果からテキストを抽出する', () => {\n      const mockParseResult = {\n        slides: [\n          {\n            index: 0,\n            textElements: [\n              {\n                id: 'text_0_0',\n                text: 'テキスト1',\n                position: { x: 0, y: 0, width: 0, height: 0 },\n              },\n              {\n                id: 'text_0_1',\n                text: 'テキスト2',\n                position: { x: 0, y: 0, width: 0, height: 0 },\n              },\n            ],\n            imagePath: 'slide_1.png',\n          },\n        ],\n        metadata: {\n          totalSlides: 1,\n          title: 'test',\n          lastModified: new Date().toISOString(),\n        },\n      };\n\n      const result = parser.extractTexts(mockParseResult);\n\n      expect(result).toHaveLength(2);\n      expect(result[0]).toBe('テキスト1');\n      expect(result[1]).toBe('テキスト2');\n    });\n  });\n\n  describe('getTextWithPositions', () => {\n    it('パース結果からテキストと位置情報を取得する', () => {\n      const mockSlide: SlideContent = {\n        index: 0,\n        textElements: [\n          { id: 'text_0_0', text: 'テキスト1', position: { x: 100, y: 100, width: 200, height: 50 } },\n          { id: 'text_0_1', text: 'テキスト2', position: { x: 100, y: 200, width: 200, height: 50 } },\n        ],\n        imagePath: 'slide_1.png',\n      };\n\n      const mockParseResult = {\n        slides: [mockSlide],\n        metadata: {\n          totalSlides: 1,\n          title: 'test',\n          lastModified: new Date().toISOString(),\n        },\n      };\n\n      const result = parser.getTextWithPositions(mockParseResult);\n\n      expect(result).toHaveLength(1);\n      expect(result[0].index).toBe(0);\n      expect(result[0].textElements).toHaveLength(2);\n      expect(result[0].textElements[0].text).toBe('テキスト1');\n      expect(result[0].textElements[1].text).toBe('テキスト2');\n      expect(result[0].textElements[0].position.x).toBe(100);\n    });\n  });\n});\n"],"names":["jest","mock","readFileSync","fn","existsSync","mockReturnValue","mkdirSync","writeFileSync","promises","access","mockResolvedValue","undefined","writeFile","readFile","Buffer","from","join","mockImplementation","args","dirname","basename","path","ext","mockStream","write","end","on","removeListener","pipe","unpipe","defaultImplementation","event","callback","JSON","stringify","slides","index","image_path","texts","positions","x","y","width","height","scriptPath","command","mode","formatter","pythonPath","pythonOptions","scriptArgs","stdoutParser","stderrParser","terminated","childProcess","parser","stdin","stdout","stderr","exitSignal","exitCode","stderrHasEnded","stdoutHasEnded","send","kill","terminate","_remaining","_endCallback","parseError","addListener","removeAllListeners","setMaxListeners","getMaxListeners","listeners","rawListeners","emit","listenerCount","prependListener","prependOnceListener","eventNames","once","off","PythonShell","mockExec","cmd","exec","promisify","Promise","resolve","describe","beforeEach","clearAllMocks","PPTXParser","getInstance","it","fs","result","parsePPTX","expect","toBeDefined","toHaveLength","textElements","text","toBe","imagePath","existsSyncMock","mockReturnValueOnce","rejects","toThrow","toHaveBeenCalled","errorImplementation","Error","mocked","mockImplementationOnce","mockPythonShell","type","position","font","name","size","color","shapes","radius","background","image","toEqual","metadata","title","author","created","modified","company","version","lastModifiedBy","revision","subject","keywords","category","description","language","presentationFormat","createdApplication","bold","italic","underline","mockSlides","Array","length","_","i","specialLayoutData","paragraphs","rotation","table_info","row","col","verticalText","fontInfo","rotatedText","tableCell","strikethrough","superscript","subscript","characterSpacing","kerning","style","alignment","lineSpacing","indentation","direction","bulletStyle","format","textElement","fillColor","strokeColor","strokeWidth","opacity","pattern","gradient","stops","angle","transparency","slide","rectangle","circle","mockParseResult","id","totalSlides","lastModified","Date","toISOString","extractTexts","mockSlide","getTextWithPositions"],"mappings":"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"}