{"version":3,"sources":["/Users/yusuketsunoda/Documents/cursor/ppttranslatorapp/worktrees/1-text-position-fix/tests/api/translate/route.test.ts"],"sourcesContent":["import { POST } from '@/app/api/translate/route';\nimport { NextRequest } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { Language, TranslationStatus, FileStatus } from '@prisma/client';\nimport { createPrismaMock, createMockUser, clearAllMocks } from '@/tests/helpers/mockSetup';\n\n// 翻訳モジュールのモック\nimport { TranslationEngine } from '@/lib/translation/engine';\nimport * as historyModule from '@/lib/translation/history';\nimport * as normalizerModule from '@/lib/translation/normalizer';\n\n// 翻訳モジュールのモック\njest.mock('@/lib/translation/engine');\njest.mock('@/lib/translation/history');\njest.mock('@/lib/translation/normalizer');\n\n// TranslationEngineクラスのモック化\nconst MockTranslationEngine = TranslationEngine as jest.MockedClass<typeof TranslationEngine>;\n\n// getServerSessionのモック\njest.mock('next-auth', () => ({\n  getServerSession: jest.fn(),\n}));\n\n// console.logのモック\nconst mockConsoleLog = jest.spyOn(console, 'log').mockImplementation();\nconst mockConsoleError = jest.spyOn(console, 'error').mockImplementation();\n\nconst prismaMock = createPrismaMock();\nconst getServerSessionMock = getServerSession as jest.Mock;\n\ndescribe('POST /api/translate', () => {\n  // TranslationEngineのモック\n  const mockTranslateTexts = jest.fn();\n  \n  beforeEach(() => {\n    clearAllMocks();\n    process.env.ANTHROPIC_API_KEY = 'test-api-key';\n    \n    // TranslationEngineのモックを設定\n    MockTranslationEngine.prototype.translateTexts = mockTranslateTexts;\n    MockTranslationEngine.prototype.setModel = jest.fn();\n    MockTranslationEngine.prototype.getModel = jest.fn().mockReturnValue('claude-3-haiku-20240307');\n    \n    // 静的メソッドのモック\n    MockTranslationEngine.isValidModel = jest.fn().mockReturnValue(true);\n    MockTranslationEngine.getFreeUserModel = jest.fn().mockReturnValue('claude-3-haiku-20240307');\n    \n    // historyモジュールのモック\n    jest.spyOn(historyModule, 'calculateRequiredCredits').mockReturnValue(1);\n    jest.spyOn(historyModule, 'checkSufficientCredits').mockResolvedValue({ isEnough: true, available: 10 });\n    jest.spyOn(historyModule, 'consumeUserCredits').mockResolvedValue(9);\n    jest.spyOn(historyModule, 'createTranslationHistory').mockResolvedValue({\n      id: 'test-history-id',\n      userId: 'test-user-id',\n      fileId: 'test-file-id',\n      fileName: 'test.pptx',\n      sourceLanguage: Language.en,\n      targetLanguage: Language.ja,\n      status: TranslationStatus.COMPLETED,\n      model: 'claude-3-haiku-20240307',\n      textCount: 1,\n      translatedCount: 1,\n      processingTimeMs: 1000,\n      fileSize: 1024,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      metadata: {},\n      error: null,\n      translatedFileKey: null\n    });\n    \n    // normalizerモジュールのモック\n    jest.spyOn(normalizerModule, 'structureTranslations').mockReturnValue([{\n      slideIndex: 0,\n      texts: [{\n        index: 0,\n        originalText: 'Hello',\n        translatedText: '翻訳されたテキスト',\n        position: { x: 0, y: 0, width: 100, height: 50 }\n      }]\n    }]);\n  });\n\n  afterEach(() => {\n    mockConsoleLog.mockClear();\n    mockConsoleError.mockClear();\n  });\n\n  it('should translate text successfully', async () => {\n    const mockUser = createMockUser({\n      id: 'test-user-id',\n      isPremium: true,\n      credits: 10,\n    });\n\n    getServerSessionMock.mockResolvedValue({\n      user: mockUser,\n    });\n\n    const mockFile = {\n      id: 'test-file-id',\n      userId: 'test-user-id',\n      originalName: 'test.pptx',\n      storagePath: '/path/to/file',\n      fileSize: 1024,\n      mimeType: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n      status: FileStatus.READY,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n\n    prismaMock.file.findUnique.mockResolvedValue(mockFile);\n    prismaMock.user.findUnique.mockResolvedValue(mockUser);\n    prismaMock.user.update.mockResolvedValue({ ...mockUser, credits: 9 });\n    prismaMock.translationHistory.create.mockResolvedValue({\n      id: 'test-history-id',\n      userId: mockUser.id,\n      fileId: mockFile.id,\n      sourceLang: Language.en,\n      targetLang: Language.ja,\n      status: TranslationStatus.COMPLETED,\n      model: 'claude-3-haiku-20240307',\n      textCount: 1,\n      translatedCount: 1,\n      processingTimeMs: 1000,\n      fileSize: 1024,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      metadata: {},\n      errorMessage: null,\n      translatedFileKey: null\n    });\n\n    // 翻訳エンジンの結果をモック\n    mockTranslateTexts.mockResolvedValue({\n      translations: ['翻訳されたテキスト'],\n      error: null,\n      processingTimeMs: 1000\n    });\n\n    const requestBody = {\n      texts: ['Hello'],\n      sourceLang: Language.en,\n      targetLang: Language.ja,\n      fileId: 'test-file-id',\n      slides: [{ index: 0, texts: [{ text: 'Hello', index: 0 }] }],\n    };\n\n    const req = new NextRequest('http://localhost/api/translate', {\n      method: 'POST',\n      body: JSON.stringify(requestBody),\n      headers: { 'Content-Type': 'application/json' },\n    });\n\n    const response = await POST(req);\n    const responseBody = await response.json();\n\n    expect(response.status).toBe(200);\n    expect(responseBody.success).toBe(true);\n    expect(responseBody.translatedSlides).toHaveLength(1);\n    expect(responseBody.translatedSlides[0].texts[0].translatedText).toBe('翻訳されたテキスト');\n    // クレジット消費が呼ばれたことを確認\n    expect(historyModule.consumeUserCredits).toHaveBeenCalledWith(\n      mockUser.id,\n      1\n    );\n  });\n\n  it('should return 401 if not authenticated', async () => {\n    getServerSessionMock.mockResolvedValue(null);\n\n    const req = new NextRequest('http://localhost/api/translate', {\n      method: 'POST',\n      body: JSON.stringify({}),\n      headers: { 'Content-Type': 'application/json' },\n    });\n\n    const response = await POST(req);\n    const responseBody = await response.json();\n\n    expect(response.status).toBe(401);\n    expect(responseBody.error).toBe('認証が必要です');\n  });\n\n  it('should return 400 if fileId is missing', async () => {\n    const mockUser = createMockUser({ id: 'test-user-id' });\n    getServerSessionMock.mockResolvedValue({ user: mockUser });\n\n    const req = new NextRequest('http://localhost/api/translate', {\n      method: 'POST',\n      body: JSON.stringify({\n        texts: ['Hello'],\n        sourceLang: Language.en,\n        targetLang: Language.ja,\n      }),\n      headers: { 'Content-Type': 'application/json' },\n    });\n\n    const response = await POST(req);\n    const responseBody = await response.json();\n\n    expect(response.status).toBe(400);\n    expect(responseBody.error).toBe('ファイルIDが必要です');\n  });\n\n  it('should return 404 if file not found', async () => {\n    const mockUser = createMockUser({ id: 'test-user-id' });\n    getServerSessionMock.mockResolvedValue({ user: mockUser });\n\n    prismaMock.file.findUnique.mockResolvedValue(null);\n\n    const req = new NextRequest('http://localhost/api/translate', {\n      method: 'POST',\n      body: JSON.stringify({\n        texts: ['Hello'],\n        sourceLang: Language.en,\n        targetLang: Language.ja,\n        fileId: 'non-existent-file-id',\n      }),\n      headers: { 'Content-Type': 'application/json' },\n    });\n\n    const response = await POST(req);\n    const responseBody = await response.json();\n\n    expect(response.status).toBe(404);\n    expect(responseBody.error).toBe('指定されたファイルIDがデータベースに存在しません');\n  });\n\n  it('should return 402 if user has insufficient credits', async () => {\n    const mockUser = createMockUser({\n      id: 'test-user-id',\n      credits: 0,\n    });\n\n    getServerSessionMock.mockResolvedValue({ user: mockUser });\n\n    const mockFile = {\n      id: 'test-file-id',\n      userId: 'test-user-id',\n      originalName: 'test.pptx',\n      storagePath: '/path/to/file',\n      fileSize: 1024,\n      mimeType: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n      status: FileStatus.READY,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n\n    prismaMock.file.findUnique.mockResolvedValue(mockFile);\n    \n    // クレジット不足をモック\n    jest.spyOn(historyModule, 'checkSufficientCredits').mockResolvedValueOnce({ \n      isEnough: false, \n      available: 0 \n    });\n\n    const req = new NextRequest('http://localhost/api/translate', {\n      method: 'POST',\n      body: JSON.stringify({\n        texts: ['Hello'],\n        sourceLang: Language.en,\n        targetLang: Language.ja,\n        fileId: 'test-file-id',\n        slides: [{ index: 0, texts: [{ text: 'Hello', index: 0 }] }],\n      }),\n      headers: { 'Content-Type': 'application/json' },\n    });\n\n    const response = await POST(req);\n    const responseBody = await response.json();\n\n    expect(response.status).toBe(402); // Payment Required\n    expect(responseBody.error).toBe('クレジットが不足しています');\n    expect(responseBody.detail.includes('利用可能クレジット: 0')).toBe(true);\n  });\n\n  it('should use default model for non-premium users', async () => {\n    const mockUser = createMockUser({\n      id: 'test-user-id',\n      isPremium: false,\n      credits: 10,\n    });\n\n    getServerSessionMock.mockResolvedValue({ user: mockUser });\n\n    const mockFile = {\n      id: 'test-file-id',\n      userId: 'test-user-id',\n      originalName: 'test.pptx',\n      storagePath: '/path/to/file',\n      fileSize: 1024,\n      mimeType: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n      status: FileStatus.READY,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n\n    prismaMock.file.findUnique.mockResolvedValue(mockFile);\n    prismaMock.user.findUnique.mockResolvedValue(mockUser);\n    prismaMock.user.update.mockResolvedValue({ ...mockUser, credits: 9 });\n    \n    // 翻訳エンジンの結果をモック\n    mockTranslateTexts.mockResolvedValue({\n      translations: ['翻訳されたテキスト'],\n      error: null,\n      processingTimeMs: 1000\n    });\n\n    const req = new NextRequest('http://localhost/api/translate', {\n      method: 'POST',\n      body: JSON.stringify({\n        texts: ['Hello'],\n        sourceLang: Language.en,\n        targetLang: Language.ja,\n        model: 'claude-3-opus-20240229',\n        fileId: 'test-file-id',\n        slides: [{ index: 0, texts: [{ text: 'Hello', index: 0 }] }],\n      }),\n      headers: { 'Content-Type': 'application/json' },\n    });\n\n    await POST(req);\n\n    // 無料ユーザー用のモデルが使用されたことを確認\n    expect(MockTranslationEngine.getFreeUserModel).toHaveBeenCalled();\n    expect(mockTranslateTexts).toHaveBeenCalled();\n  });\n\n  it('should handle translation API errors', async () => {\n    const mockUser = createMockUser({\n      id: 'test-user-id',\n      credits: 10,\n    });\n\n    getServerSessionMock.mockResolvedValue({ user: mockUser });\n\n    const mockFile = {\n      id: 'test-file-id',\n      userId: 'test-user-id',\n      originalName: 'test.pptx',\n      storagePath: '/path/to/file',\n      fileSize: 1024,\n      mimeType: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n      status: FileStatus.READY,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n\n    prismaMock.file.findUnique.mockResolvedValue(mockFile);\n    prismaMock.user.findUnique.mockResolvedValue(mockUser);\n    // 翻訳エラーをモック\n    mockTranslateTexts.mockResolvedValue({\n      translations: [],\n      error: new Error('API Error'),\n      processingTimeMs: 1000\n    });\n\n    const req = new NextRequest('http://localhost/api/translate', {\n      method: 'POST',\n      body: JSON.stringify({\n        texts: ['Hello'],\n        sourceLang: Language.en,\n        targetLang: Language.ja,\n        fileId: 'test-file-id',\n        slides: [{ index: 0, texts: [{ text: 'Hello', index: 0 }] }],\n      }),\n      headers: { 'Content-Type': 'application/json' },\n    });\n\n    const response = await POST(req);\n    const responseBody = await response.json();\n\n    expect(response.status).toBe(500);\n    expect(responseBody.error).toBe('翻訳に失敗しました');\n    // 失敗した翻訳履歴が作成されたことを確認\n    expect(historyModule.createTranslationHistory).toHaveBeenCalled();\n  });\n}); "],"names":["jest","mock","getServerSession","fn","MockTranslationEngine","TranslationEngine","mockConsoleLog","spyOn","console","mockImplementation","mockConsoleError","prismaMock","createPrismaMock","getServerSessionMock","describe","mockTranslateTexts","beforeEach","clearAllMocks","process","env","ANTHROPIC_API_KEY","prototype","translateTexts","setModel","getModel","mockReturnValue","isValidModel","getFreeUserModel","historyModule","mockResolvedValue","isEnough","available","id","userId","fileId","fileName","sourceLanguage","Language","en","targetLanguage","ja","status","TranslationStatus","COMPLETED","model","textCount","translatedCount","processingTimeMs","fileSize","createdAt","Date","updatedAt","metadata","error","translatedFileKey","normalizerModule","slideIndex","texts","index","originalText","translatedText","position","x","y","width","height","afterEach","mockClear","it","mockUser","createMockUser","isPremium","credits","user","mockFile","originalName","storagePath","mimeType","FileStatus","READY","file","findUnique","update","translationHistory","create","sourceLang","targetLang","errorMessage","translations","requestBody","slides","text","req","NextRequest","method","body","JSON","stringify","headers","response","POST","responseBody","json","expect","toBe","success","translatedSlides","toHaveLength","consumeUserCredits","toHaveBeenCalledWith","mockResolvedValueOnce","detail","includes","toHaveBeenCalled","Error","createTranslationHistory"],"mappings":"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"}