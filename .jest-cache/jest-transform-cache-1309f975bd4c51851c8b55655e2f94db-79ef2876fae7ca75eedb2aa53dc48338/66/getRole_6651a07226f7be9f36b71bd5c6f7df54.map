{"version":3,"file":"getRole.js","sources":["../sources/getRole.ts"],"sourcesContent":["// https://w3c.github.io/html-aria/#document-conformance-requirements-for-use-of-aria-attributes-in-html\n\nimport { presentationRoles } from \"./util\";\n\n/**\n * Safe Element.localName for all supported environments\n * @param element\n */\nexport function getLocalName(element: Element): string {\n\treturn (\n\t\t// eslint-disable-next-line no-restricted-properties -- actual guard for environments without localName\n\t\telement.localName ??\n\t\t// eslint-disable-next-line no-restricted-properties -- required for the fallback\n\t\telement.tagName.toLowerCase()\n\t);\n}\n\nconst localNameToRoleMappings: Record<string, string | undefined> = {\n\tarticle: \"article\",\n\taside: \"complementary\",\n\tbutton: \"button\",\n\tdatalist: \"listbox\",\n\tdd: \"definition\",\n\tdetails: \"group\",\n\tdialog: \"dialog\",\n\tdt: \"term\",\n\tfieldset: \"group\",\n\tfigure: \"figure\",\n\t// WARNING: Only with an accessible name\n\tform: \"form\",\n\tfooter: \"contentinfo\",\n\th1: \"heading\",\n\th2: \"heading\",\n\th3: \"heading\",\n\th4: \"heading\",\n\th5: \"heading\",\n\th6: \"heading\",\n\theader: \"banner\",\n\thr: \"separator\",\n\thtml: \"document\",\n\tlegend: \"legend\",\n\tli: \"listitem\",\n\tmath: \"math\",\n\tmain: \"main\",\n\tmenu: \"list\",\n\tnav: \"navigation\",\n\tol: \"list\",\n\toptgroup: \"group\",\n\t// WARNING: Only in certain context\n\toption: \"option\",\n\toutput: \"status\",\n\tprogress: \"progressbar\",\n\t// WARNING: Only with an accessible name\n\tsection: \"region\",\n\tsummary: \"button\",\n\ttable: \"table\",\n\ttbody: \"rowgroup\",\n\ttextarea: \"textbox\",\n\ttfoot: \"rowgroup\",\n\t// WARNING: Only in certain context\n\ttd: \"cell\",\n\tth: \"columnheader\",\n\tthead: \"rowgroup\",\n\ttr: \"row\",\n\tul: \"list\",\n};\n\nconst prohibitedAttributes: Record<string, Set<string>> = {\n\tcaption: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tcode: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tdeletion: new Set([\"aria-label\", \"aria-labelledby\"]),\n\temphasis: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tgeneric: new Set([\"aria-label\", \"aria-labelledby\", \"aria-roledescription\"]),\n\tinsertion: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tnone: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tparagraph: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tpresentation: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tstrong: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tsubscript: new Set([\"aria-label\", \"aria-labelledby\"]),\n\tsuperscript: new Set([\"aria-label\", \"aria-labelledby\"]),\n};\n\n/**\n *\n * @param element\n * @param role The role used for this element. This is specified to control whether you want to use the implicit or explicit role.\n */\nfunction hasGlobalAriaAttributes(element: Element, role: string): boolean {\n\t// https://rawgit.com/w3c/aria/stable/#global_states\n\t// commented attributes are deprecated\n\treturn [\n\t\t\"aria-atomic\",\n\t\t\"aria-busy\",\n\t\t\"aria-controls\",\n\t\t\"aria-current\",\n\t\t\"aria-description\",\n\t\t\"aria-describedby\",\n\t\t\"aria-details\",\n\t\t// \"disabled\",\n\t\t\"aria-dropeffect\",\n\t\t// \"errormessage\",\n\t\t\"aria-flowto\",\n\t\t\"aria-grabbed\",\n\t\t// \"haspopup\",\n\t\t\"aria-hidden\",\n\t\t// \"invalid\",\n\t\t\"aria-keyshortcuts\",\n\t\t\"aria-label\",\n\t\t\"aria-labelledby\",\n\t\t\"aria-live\",\n\t\t\"aria-owns\",\n\t\t\"aria-relevant\",\n\t\t\"aria-roledescription\",\n\t].some((attributeName) => {\n\t\treturn (\n\t\t\telement.hasAttribute(attributeName) &&\n\t\t\t!prohibitedAttributes[role]?.has(attributeName)\n\t\t);\n\t});\n}\n\nfunction ignorePresentationalRole(\n\telement: Element,\n\timplicitRole: string,\n): boolean {\n\t// https://rawgit.com/w3c/aria/stable/#conflict_resolution_presentation_none\n\treturn hasGlobalAriaAttributes(element, implicitRole);\n}\n\nexport default function getRole(element: Element): string | null {\n\tconst explicitRole = getExplicitRole(element);\n\tif (explicitRole === null || presentationRoles.indexOf(explicitRole) !== -1) {\n\t\tconst implicitRole = getImplicitRole(element);\n\t\tif (\n\t\t\tpresentationRoles.indexOf(explicitRole || \"\") === -1 ||\n\t\t\tignorePresentationalRole(element, implicitRole || \"\")\n\t\t) {\n\t\t\treturn implicitRole;\n\t\t}\n\t}\n\n\treturn explicitRole;\n}\n\nfunction getImplicitRole(element: Element): string | null {\n\tconst mappedByTag = localNameToRoleMappings[getLocalName(element)];\n\tif (mappedByTag !== undefined) {\n\t\treturn mappedByTag;\n\t}\n\n\tswitch (getLocalName(element)) {\n\t\tcase \"a\":\n\t\tcase \"area\":\n\t\tcase \"link\":\n\t\t\tif (element.hasAttribute(\"href\")) {\n\t\t\t\treturn \"link\";\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"img\":\n\t\t\tif (\n\t\t\t\telement.getAttribute(\"alt\") === \"\" &&\n\t\t\t\t!ignorePresentationalRole(element, \"img\")\n\t\t\t) {\n\t\t\t\treturn \"presentation\";\n\t\t\t}\n\t\t\treturn \"img\";\n\t\tcase \"input\": {\n\t\t\tconst { type } = element as HTMLInputElement;\n\t\t\tswitch (type) {\n\t\t\t\tcase \"button\":\n\t\t\t\tcase \"image\":\n\t\t\t\tcase \"reset\":\n\t\t\t\tcase \"submit\":\n\t\t\t\t\treturn \"button\";\n\t\t\t\tcase \"checkbox\":\n\t\t\t\tcase \"radio\":\n\t\t\t\t\treturn type;\n\t\t\t\tcase \"range\":\n\t\t\t\t\treturn \"slider\";\n\t\t\t\tcase \"email\":\n\t\t\t\tcase \"tel\":\n\t\t\t\tcase \"text\":\n\t\t\t\tcase \"url\":\n\t\t\t\t\tif (element.hasAttribute(\"list\")) {\n\t\t\t\t\t\treturn \"combobox\";\n\t\t\t\t\t}\n\t\t\t\t\treturn \"textbox\";\n\n\t\t\t\tcase \"search\":\n\t\t\t\t\tif (element.hasAttribute(\"list\")) {\n\t\t\t\t\t\treturn \"combobox\";\n\t\t\t\t\t}\n\t\t\t\t\treturn \"searchbox\";\n\t\t\t\tcase \"number\":\n\t\t\t\t\treturn \"spinbutton\";\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\tcase \"select\":\n\t\t\tif (\n\t\t\t\telement.hasAttribute(\"multiple\") ||\n\t\t\t\t(element as HTMLSelectElement).size > 1\n\t\t\t) {\n\t\t\t\treturn \"listbox\";\n\t\t\t}\n\t\t\treturn \"combobox\";\n\t}\n\treturn null;\n}\n\nfunction getExplicitRole(element: Element): string | null {\n\tconst role = element.getAttribute(\"role\");\n\tif (role !== null) {\n\t\tconst explicitRole = role.trim().split(\" \")[0];\n\t\t// String.prototype.split(sep, limit) will always return an array with at least one member\n\t\t// as long as limit is either undefined or > 0\n\t\tif (explicitRole.length > 0) {\n\t\t\treturn explicitRole;\n\t\t}\n\t}\n\n\treturn null;\n}\n"],"names":["_util","require","getLocalName","element","_element$localName","localName","tagName","toLowerCase","localNameToRoleMappings","article","aside","button","datalist","dd","details","dialog","dt","fieldset","figure","form","footer","h1","h2","h3","h4","h5","h6","header","hr","html","legend","li","math","main","menu","nav","ol","optgroup","option","output","progress","section","summary","table","tbody","textarea","tfoot","td","th","thead","tr","ul","prohibitedAttributes","caption","Set","code","deletion","emphasis","generic","insertion","none","paragraph","presentation","strong","subscript","superscript","hasGlobalAriaAttributes","role","some","attributeName","_prohibitedAttributes","hasAttribute","has","ignorePresentationalRole","implicitRole","getRole","explicitRole","getExplicitRole","presentationRoles","indexOf","getImplicitRole","mappedByTag","undefined","getAttribute","_ref","type","size","trim","split","length"],"mappings":"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"}